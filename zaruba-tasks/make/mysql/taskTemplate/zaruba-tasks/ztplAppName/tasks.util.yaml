tasks:

  runZtplAppNameSql:
    extend: 
    configRefs:
      - ztplAppName
      - ztplAppNameContainer
    envRef: ztplAppName
    config:
      user: root
      password: '{{ .GetEnv "MYSQL_ROOT_PASSWORD" }}'
      database: '{{ .GetEnv "MYSQL_DATABASE" }}'
      queries: ""
      scriptTemplate: '{{ .GetConfig "queries" }}'
      localScriptFile: '{{ .GetWorkPath (printf "tmp/%s.tmp.sql" .Name) }}'
      remoteScriptFile: '/{{ .Name }}.tmp.sql'
      runScript: |
        REMOTE_SCRIPT_FILE="{{ .GetConfig "remoteScriptFile" }}"
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        USER="{{ .GetConfig "user" }}"
        PASSWORD="{{ .GetConfig "password" }}"
        docker exec "${CONTAINER_NAME}" bash -c "mysql --user=\"${USER}\" --password=\"${PASSWORD}\" < \"${REMOTE_SCRIPT_FILE}\""
        docker exec -u 0 "${CONTAINER_NAME}" rm "${REMOTE_SCRIPT_FILE}"