tasks:
 
  makeEksDeployment:
    icon: ðŸ“™
    extend: makeApp
    inputs:
      - appDirectory
      - eksRegion
      - eksClusterName
    configRef: makeEks
    configs:
      eksRegion: '{{ if .GetValue "eksRegion" }}{{ .GetValue "eksRegion" }}{{ else }}us-east-1{{ end }}'
      eksClusterName: '{{ if .GetValue "eksClusterName" }}{{ .GetValue "eksClusterName" }}{{ else }}{{ .ProjectName }}{{ end }}'
      templateLocations: |
        [
          "{{ .ZarubaHome }}/zaruba-tasks/make/eks/eksDeploymentTemplate"
        ]
      _prepareVariables: |
        _ZRB_EKS_REGION='{{ .GetConfig "eksRegion" }}'
        _ZRB_EKS_CLUSTER_NAME={{ .Util.Str.ToKebab (.GetConfig "eksClusterName") }}
      _prepareReplacementMap: |
        _setReplacementMap "ztpl-eks-region" "${_ZRB_EKS_REGION}"
        _setReplacementMap "ztpl-eks-cluster-name" "${_ZRB_EKS_CLUSTER_NAME}"