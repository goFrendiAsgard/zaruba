tasks:

  core.setupPyUtil:
    icon: ğŸ
    description: |
      Setup python helper utitities.
      USAGE:
      ```yaml
      runTask:
        extend: core.runCoreScript
        dependencies: 
        - core.setupPyUtil
        config:
          start: |
            . ${PY_UTIL} "show_log"
      ```
    private: true
    extend: core.runCoreScript
    logless: true
    config:
      start: |
        . ${UTIL}/py_install.sh
  

  setupUbuntu:
    icon: ğŸ”¨
    description: |
      Install essential packages for ubuntu/mint/debian. Root privilege is required
      USAGE:
        sudo -E zaruba please setupUbuntu
    extend: core.runCoreScript
    timeout: 1h
    config:
      start: |
        {{ $d := .Decoration -}}
        {{ if .GetKwarg "home" }}HOME="{{ .GetKwarg "home" }}"{{ end }}
        . ${UTIL}/check_setup_ubuntu.sh "${HOME}"
        echo "ğŸ“¡ {{ $d.Bold }}{{ $d.Yellow }}Update repository{{ $d.Normal }}"
        apt-get update
        apt-get upgrade -y
        echo "ğŸ”½ {{ $d.Bold }}{{ $d.Yellow }}Install packages{{ $d.Normal }}"
        apt-get install -y build-essential libssl-dev zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev wget curl llvm libncurses5-dev libncursesw5-dev xz-utils tk-dev libffi-dev liblzma-dev python-openssl git ncat make tmux zsh neovim cowsay figlet lolcat
        if [ ! -z "$(docker -v)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Docker was already installed{{ $d.Normal }}"
        else
          echo "ğŸ³ {{ $d.Bold }}{{ $d.Yellow }}Install docker{{ $d.Normal }}"
          apt-get install -y docker.io
        fi
        echo ğŸ‰ğŸ‰ğŸ‰
        echo "{{ $d.Bold }}{{ $d.Yellow }}Complete !!!{{ $d.Normal }}"
        echo "TIPS:"
        echo "* If you are using WSL, please enable WSL2 Backend for best experience (https://docs.docker.com/docker-for-windows/wsl/)"
    

  setupPyenv:
    icon: ğŸ”¨
    description: |
      Install Pyenv and pipenv. Useful if you are going to start with Python.
      Some zaruba tasks required python and pipenv to be installed, so you likely going to run this anyway.
      USAGE:
        zaruba please setupPyenv
    extend: core.runCoreScript
    timeout: 1h
    config:
      pythonVersion: '{{ if .GetKwarg "pythonVersion" }}{{ .GetKwarg "pythonVersion" }}{{ else }}3.8.6{{ end }}'
      start: |
        {{ $d := .Decoration -}}
        {{ if .GetKwarg "home" }}HOME="{{ .GetKwarg "home" }}"{{ end }}
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" pyenv)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Pyenv was already installed{{ $d.Normal }}"
        else
          echo "ğŸ {{ $d.Bold }}{{ $d.Yellow }}Install pyenv{{ $d.Normal }}"
          curl -L https://github.com/pyenv/pyenv-installer/raw/master/bin/pyenv-installer | sh
          . "${UTIL}/append_if_exist.sh" "$(cat "${ZARUBA_HOME}/scripts/templates/shell/pyenv.sh")" "${BOOTSTRAP_SCRIPT}"
          . "${BOOTSTRAP_SCRIPT}"
          echo "ğŸ {{ $d.Bold }}{{ $d.Yellow }}Install python {{ .GetConfig "pythonVersion" }}{{ $d.Normal }}"
          pyenv install {{ .GetConfig "pythonVersion" }}
          pyenv global {{ .GetConfig "pythonVersion" }}
        fi
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" python)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Python was already installed{{ $d.Normal }}"
        else
          echo "ğŸ {{ $d.Bold }}{{ $d.Yellow }}Install python {{ .GetConfig "pythonVersion" }}{{ $d.Normal }}"
          pyenv install {{ .GetConfig "pythonVersion" }}
          pyenv global {{ .GetConfig "pythonVersion" }}
        fi
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" pipenv)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Pipenv was already installed{{ $d.Normal }}"
        else
          echo "ğŸ {{ $d.Bold }}{{ $d.Yellow }}Install pipenv{{ $d.Normal }}"
          pip install pipenv
          if [ -d "${HOME}/.pipenv/shims" ]
          then
            chmod 755 "${HOME}/.pipenv/shims"
          fi
        fi
        echo ğŸ‰ğŸ‰ğŸ‰
        echo "{{ $d.Bold }}{{ $d.Yellow }}Complete !!!{{ $d.Normal }}"


  setupNvm:
    icon: ğŸ”¨
    description: |
      Install NVM for Node.js development.
      USAGE:
        zaruba please setupNvm
    extend: core.runCoreScript
    timeout: 1h
    config:
      start: |
        {{ $d := .Decoration -}}
        {{ if .GetKwarg "home" }}HOME="{{ .GetKwarg "home" }}"{{ end }}
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" nvm)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}NVM was already installed{{ $d.Normal }}"
        else
          echo "ğŸ¸ {{ $d.Bold }}{{ $d.Yellow }}Install NVM{{ $d.Normal }}"
          curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.0/install.. | sh
          . "${UTIL}/append_if_exist.sh" "$(cat "${ZARUBA_HOME}/scripts/templates/shell/nvm.sh")" "${BOOTSTRAP_SCRIPT}"
          . "${BOOTSTRAP_SCRIPT}"
          nvm install node
          . "${BOOTSTRAP_SCRIPT}"
        fi
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" node-gyp)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Node-gyp was already installed{{ $d.Normal }}"
        else 
          echo "ğŸ¸ {{ $d.Bold }}{{ $d.Yellow }}Install node-gyp{{ $d.Normal }}"
          npm install -g node-gyp
        fi
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" tsc)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Typescript was already installed{{ $d.Normal }}"
        else
          echo "ğŸ¸ {{ $d.Bold }}{{ $d.Yellow }}Install typescript{{ $d.Normal }}"
          npm install -g typescript
        fi
        echo ğŸ‰ğŸ‰ğŸ‰
        echo "{{ $d.Bold }}{{ $d.Yellow }}Complete !!!{{ $d.Normal }}"
       

  setupSdkman:
    icon: ğŸ”¨
    description: |
      Install SDKMan for Java/Scala development.
      USAGE:
        zaruba please setupSdkman
    extend: core.runCoreScript
    timeout: 1h
    config:
      cmd: /bin/bash
      javaVersion: '{{ if .GetKwarg "javaVersion" }}{{ .GetKwarg "javaVersion" }}{{ else }}8.0.275.open-adpt{{ end }}'
      start: |
        {{ $d := .Decoration -}}
        {{ if .GetKwarg "home" }}HOME="{{ .GetKwarg "home" }}"{{ end }}
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" sdk)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Sdkman was already installed{{ $d.Normal }}"
        else
          echo "â˜• {{ $d.Bold }}{{ $d.Yellow }}Install sdkman{{ $d.Normal }}"
          curl -s "https://get.sdkman.io" | bash
          . "${UTIL}/append_if_exist.sh" "$(cat "${ZARUBA_HOME}/scripts/templates/shell/sdkman.sh")" "${BOOTSTRAP_SCRIPT}"
          . "${BOOTSTRAP_SCRIPT}"
          echo "â˜•{{ $d.Bold }}{{ $d.Yellow }}Install java {{ .GetConfig "javaVersion" }}{{ $d.Normal }}"
          sdk install java {{ .GetConfig "javaVersion" }}
          echo "â˜• {{ $d.Bold }}{{ $d.Yellow }}Install scala{{ $d.Normal }}"
          sdk install scala
        fi 
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" java)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Java was already installed{{ $d.Normal }}"
        else
          echo "â˜•{{ $d.Bold }}{{ $d.Yellow }}Install java {{ .GetConfig "javaVersion" }}{{ $d.Normal }}"
          sdk install java {{ .GetConfig "javaVersion" }}
        fi
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" scala)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Scala was already installed{{ $d.Normal }}"
        else
          echo "â˜•{{ $d.Bold }}{{ $d.Yellow }}Install scala{{ $d.Normal }}"
          sdk install scala
        fi
        echo ğŸ‰ğŸ‰ğŸ‰
        echo "{{ $d.Bold }}{{ $d.Yellow }}Complete !!!{{ $d.Normal }}"
  
  
  setupSpark:
    icon: ğŸ”¨
    description: |
      Install Spark and hadoop.
      USAGE:
        zaruba please setupSpark
    extend: core.runCoreScript
    timeout: 1h
    config:
      cmd: /bin/bash
      start: |
        {{ $d := .Decoration -}}
        {{ if .GetKwarg "home" }}HOME="{{ .GetKwarg "home" }}"{{ end }}
        if [ ! -z "$(. "${UTIL}/is_command_exist.sh" spark-shell)" ]
        then
          echo "ğŸ‘ {{ $d.Bold }}{{ $d.Yellow }}Spark was already installed{{ $d.Normal }}"
        else
          echo "â˜• {{ $d.Bold }}{{ $d.Yellow }}Install spark and hadoop{{ $d.Normal }}"
          wget https://apachemirror.sg.wuchna.com/spark/spark-3.0.1/spark-3.0.1-bin-hadoop2.7.tgz
          mkdir -p "${HOME}/.spark"
          tar -xvzf spark-3.0.1-bin-hadoop2.7.tgz -C "${HOME}/.spark"
          . "${UTIL}/append_if_exist.sh" "$(cat "${ZARUBA_HOME}/scripts/templates/shell/spark.sh")" "${BOOTSTRAP_SCRIPT}"
          . "${BOOTSTRAP_SCRIPT}"
        fi
        echo ğŸ‰ğŸ‰ğŸ‰
        echo "{{ $d.Bold }}{{ $d.Yellow }}Complete !!!{{ $d.Normal }}"